# 数据预处理与逻辑回归建模流程说明

## 一、数据预处理阶段（Relative.R）

### 1.1 数据加载与初步探索

| 步骤 | 操作 | 说明 |
|------|------|------|
| 加载数据 | `read.csv("USvideos_modified.csv")` | 读取原始 YouTube 视频数据 |
| 结构查看 | `str(data)` | 查看各列数据类型 |
| 描述统计 | `summary(data)` | 生成数值变量的基本统计量 |
| 缺失值检测 | `md.pattern(data)` | 可视化缺失值分布模式 |
| 重复值检测 | `duplicated(data)` | 统计重复行数量 |

### 1.2 数据清洗

| 步骤 | 操作 | 目的 |
|------|------|------|
| 列筛选 | 保留 12 个关键列 | 移除无关变量，包括：`video_id`, `publish_date`, `publish_hour`, `views`, `likes`, `comment_count`, `tag_appeared_in_title_count`, `tag_appeared_in_title`, `title`, `tags_count`, `subscriber`, `comments_disabled` |
| 过滤禁用评论视频 | `filter(comments_disabled == FALSE)` | 删除评论被禁用的视频，确保互动数据可用 |
| 删除缺失值 | `na.omit(data)` | 移除含有任何缺失值的行 |

### 1.3 特征工程

#### 构造新特征

| 新特征 | 计算公式 | 业务含义 |
|--------|----------|----------|
| `interaction_rate` | `(likes + comment_count) / views` | 互动率，衡量视频的用户参与度 |
| `title_length` | `nchar(title)` | 标题字符长度 |
| `has_question` | `grepl("\\?", title)` → 0/1 | 标题是否包含问号 |
| `has_exclamation` | `grepl("\\!", title)` → 0/1 | 标题是否包含感叹号 |
| `is_weekend` | `wday(publish_date) %in% c(1,7)` → 0/1 | 是否在周末发布 |
| `is_hot` | `interaction_rate >= quantile(0.80)` → 0/1 | **目标变量**：互动率前 20% 定义为爆款 |

#### 变量类型转换

将分类变量转换为因子类型，便于建模：
- `is_weekend_f`、`has_question_f`、`has_exclamation_f`、`is_hot_f`

### 1.4 相关性分析

- 选取 9 个数值特征计算 Pearson 相关系数矩阵
- 绘制热力图可视化特征间的线性关系

### 1.5 输出文件

- 保存清洗后的数据至 `video_data_processed.csv`
- 保存相关性热力图、分类特征条形图、箱线图等至 `plots/` 目录

---

## 二、原始逻辑回归模型（Model 1）

### 2.1 数据准备

| 步骤 | 操作 |
|------|------|
| 数据加载 | 读取 `video_data_processed.csv` |
| 因子转换 | 将 `is_hot`, `has_question`, `has_exclamation`, `is_weekend` 转为因子型 |
| 数据划分 | 70% 训练集 / 30% 测试集（`set.seed(42)` 保证可复现） |

### 2.2 模型构建

**模型公式：**
```r
is_hot_f ~ publish_hour + title_length + tags_count + 
           has_question_f + has_exclamation_f + 
           is_weekend_f + tag_appeared_in_title_count + subscriber
```

**特征说明：**

| 特征 | 类型 | 描述 |
|------|------|------|
| `publish_hour` | 连续 | 发布时间（0-23 小时） |
| `title_length` | 连续 | 标题字符数 |
| `tags_count` | 连续 | 标签数量 |
| `has_question_f` | 分类 | 标题是否有问号 |
| `has_exclamation_f` | 分类 | 标题是否有感叹号 |
| `is_weekend_f` | 分类 | 是否周末发布 |
| `tag_appeared_in_title_count` | 连续 | 标签出现在标题中的次数 |
| `subscriber` | 连续 | 频道订阅数 |

### 2.3 模型评估

| 评估内容 | 方法 |
|----------|------|
| 系数解释 | 计算优势比 OR 及 95% 置信区间 |
| 预测概率 | `predict(type = "response")` 获取爆款概率 |
| ROC/AUC | 使用 `pROC` 包计算 AUC 值 |
| 混淆矩阵 | 计算 TP、FP、TN、FN |
| 评估指标 | Accuracy、Precision、Recall、Specificity、F1 |

### 2.4 阈值优化

- **默认阈值**：0.20（考虑到爆款占比约 20%）
- **优化方法**：网格搜索 0.05~0.95，以 F1 分数最大化为目标
- **最优阈值**：0.19

### 2.5 原始模型结果

| 指标 | 默认阈值 (0.20) | 最优阈值 (0.19) |
|------|----------------|----------------|
| AUC | 0.7026 | - |
| Accuracy | 0.7573 | 0.7446 |
| Precision | 0.2890 | 0.2844 |
| Recall | 0.4416 | 0.4822 |
| F1 | 0.3494 | 0.3578 |

---

## 三、优化逻辑回归模型（Model 2）

### 3.1 特征工程优化

相比原始模型，优化模型进行了以下改进：

#### 优化 1：发布时间分箱 (`publish_hour_cat`)

将连续的发布小时转换为 4 个时段：

| 时段 | 小时范围 | 样本数 |
|------|----------|--------|
| 凌晨 | 0-5 点 | 822 |
| 清晨 | 6-8 点 | 288 |
| 白天 | 9-17 点 | 1997 |
| 晚高峰 | 18-23 点 | 1343 |

**优化原因**：捕捉发布时段的非线性效应，不同时段的用户活跃度不同。

#### 优化 2：订阅数分箱 (`subscriber_cat`)

基于 log 转换进行分箱：

| 频道等级 | 条件 | 样本数 |
|----------|------|--------|
| 小频道 | log(subscriber) < 5 | 152 |
| 中频道 | 5 ≤ log(subscriber) ≤ 10 | 363 |
| 大频道 | log(subscriber) > 10 | 3935 |

**优化原因**：订阅数严重右偏，分箱能更好反映频道等级差异。

#### 优化 3：标题长度二次项

**模型形式**：`title_length_scaled + I(title_length_scaled^2)`

**优化原因**：验证"标题过短或过长都不利于爆款"的假设。

#### 优化 4：标签数量分箱 (`tags_count_cat`)

| 等级 | 条件 | 样本数 |
|------|------|--------|
| 少 | ≤3 个 | 373 |
| 中 | 4-6 个 | 379 |
| 多 | >6 个 | 3698 |

#### 优化 5：连续变量标准化

对以下变量进行 Z-score 标准化：
- `title_length_scaled`
- `tag_appeared_in_title_count_scaled`

**优化原因**：消除量纲差异，使系数更具可比性。

### 3.2 优化模型公式

```r
is_hot_f ~ publish_hour_cat + subscriber_cat + tags_count_cat +
           title_length_scaled + I(title_length_scaled^2) +
           tag_appeared_in_title_count_scaled + 
           has_question_f + has_exclamation_f + is_weekend_f
```

### 3.3 优化模型结果

| 指标 | 默认阈值 (0.20) | 最优阈值 (0.16) |
|------|----------------|----------------|
| AUC | 0.7550 | - |
| Accuracy | 0.7513 | 0.6929 |
| Precision | 0.2997 | 0.2831 |
| Recall | 0.5127 | 0.7056 |
| F1 | 0.3783 | 0.4041 |

---

## 四、两次建模对比总结

### 4.1 性能提升

| 指标 | 原始模型 | 优化模型 | 提升幅度 |
|------|----------|----------|----------|
| **AUC** | 0.7026 | 0.7550 | **+7.5%** |
| **Recall** | 0.4416 | 0.5127 | **+16.1%** |
| **F1** | 0.3494 | 0.3783 | **+8.3%** |

### 4.2 关键发现

| 发现 | 原始模型 | 优化模型 |
|------|----------|----------|
| 发布时间 | 线性正向（+3% odds/小时） | **晚高峰 +45% odds**，白天/清晨负向 |
| 订阅数 | 不显著 | **大频道 5.52 倍**优势 |
| 标题长度 | 线性负向 | 线性负向（二次项不显著） |
| 感叹号 | 2.12 倍优势 | 1.87 倍优势 |

### 4.3 建模流程图

```
原始数据 (USvideos_modified.csv)
        ↓
   数据预处理 (Relative.R)
   - 缺失值处理
   - 特征构造
   - 定义爆款标签
        ↓
处理后数据 (video_data_processed.csv)
        ↓
   ┌────────────────────────────────────┐
   │                                    │
   ↓                                    ↓
原始模型 (Model 1)              优化模型 (Model 2)
- 原始连续特征                  - 分箱特征
- 8 个预测变量                  - 标准化
                                - 二次项
   │                                    │
   ↓                                    ↓
AUC = 0.7026                     AUC = 0.7550
F1 = 0.3494                      F1 = 0.3783
```

---

## 五、结论

1. **数据预处理**是建模的基础，通过构造 `interaction_rate` 定义爆款标签，为后续分类建模提供了明确的目标变量。

2. **原始模型**使用原始特征直接建模，发现 `title_length`、`has_exclamation_f` 是最显著的预测因子。

3. **优化模型**通过分箱、标准化等特征工程手段，显著提升了模型的区分能力（AUC +7.5%）和召回率（+16.1%），并发现了"大频道"和"晚高峰发布"是爆款的重要预测因子。

4. **业务启示**：
   - 标题宜短不宜长
   - 标题中使用感叹号有助于提升互动
   - 晚高峰（18-23点）发布效果最佳
   - 大频道更容易产出爆款
