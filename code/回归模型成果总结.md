# 回归模型部分成果总结

## 📋 项目概述

**任务分工**：负责YouTube视频热度预测的**回归模型**部分  
**目标**：根据视频发布前的特征信息，预测视频的观看量（views）  
**方法**：使用统计回归模型（OLS、Ridge、Lasso、ElasticNet）进行建模分析

---

## 📁 代码文件清单

### 核心代码文件（6个主要模块）

| 文件名 | 功能说明 | 状态 |
|--------|----------|------|
| `1_preprocess.py` | 数据预处理：对数变换、特征提取、哑变量处理 | ✅ 已完成 |
| `2_check_vif.py` | VIF共线性检查：识别高共线性特征 | ✅ 已完成 |
| `3_train_model.py` | OLS模型训练：单模型训练（增强版） | ✅ 已完成 |
| `3.5_model_comparison.py` | 多模型对比：自动对比4种模型并选择最佳 | ✅ 已完成 |
| `4_visualization.py` | 可视化分析：生成4种分析图表 | ✅ 已完成 |
| `5_model_evaluation.py` | 详细评估：统计检验和评估报告 | ✅ 已完成 |

### 配置文件

| 文件名 | 功能说明 |
|--------|----------|
| `config.py` | 统一配置文件：路径、特征、模型参数配置 |

### 说明文档

| 文件名 | 内容 |
|--------|------|
| `README_优化说明.md` | 优化功能详细说明 |
| `使用流程说明.md` | 完整使用流程和输入输出说明 |

---

## 📊 输出文件清单

### 1. 数据文件

| 文件路径 | 说明 | 用途 |
|----------|------|------|
| `output/processed_data.csv` | 预处理后的数据 | 包含所有特征和目标变量（log_views），用于模型训练 |

### 2. 模型文件

| 文件路径 | 说明 | 模型类型 |
|----------|------|----------|
| `output/ols_model.pkl` | OLS模型 | statsmodels OLS回归模型 |
| `output/ols_model_lasso.pkl` | Lasso模型（最佳模型） | sklearn Lasso回归模型 |
| `output/ols_model_lasso_scaler.pkl` | 标准化器 | 用于特征标准化的StandardScaler |

**说明**：当前最佳模型是 **Lasso模型**，已自动保存。

### 3. 模型对比结果

| 文件路径 | 说明 | 内容 |
|----------|------|------|
| `output/ols_model_comparison.csv` | 模型对比结果 | 包含4种模型的R²、RMSE、MAE对比 |

**对比结果**（按R²排序）：
- **Lasso模型**：R² = 0.2890, RMSE = 1.5509, MAE = 1.2532（最佳）
- OLS模型：R² = 0.2888, RMSE = 1.5511, MAE = 1.2540
- Ridge模型：R² = 0.2877, RMSE = 1.5523, MAE = 1.2544
- ElasticNet模型：R² = 0.2839, RMSE = 1.5564, MAE = 1.2564

### 4. 可视化图表（4个PNG文件）

| 文件路径 | 图表类型 | 说明 |
|----------|----------|------|
| `output/plots/predicted_vs_actual.png` | 散点图 | 预测值 vs 实际值对比图 |
| `output/plots/residual_analysis.png` | 组合图 | 残差分析图（残差图 + Q-Q图） |
| `output/plots/feature_importance.png` | 柱状图 | Top 20特征重要性排序 |
| `output/plots/residual_distribution.png` | 直方图 | 残差分布直方图 |

### 5. 评估报告

| 文件路径 | 格式 | 说明 |
|----------|------|------|
| `output/evaluation_report.json` | JSON | 详细的模型评估报告（包含性能指标、统计检验结果） |

**当前模型性能指标**（基于Lasso模型）：
- **R² (决定系数)**：0.3032
- **RMSE (均方根误差)**：1.5529
- **MAE (平均绝对误差)**：1.2183
- **MAPE (平均绝对百分比误差)**：10.46%
- **样本数**：4,525
- **特征数**：32
- **显著特征数**：10（p < 0.05）

---

## 🎯 主要成果

### 1. 完整的建模流程

建立了从数据预处理到模型评估的完整流水线：

```
数据预处理 → VIF检查 → 模型训练/对比 → 可视化 → 评估报告
```

### 2. 多模型对比分析

实现了4种回归模型的自动对比：
- **OLS（普通最小二乘）**：基础统计模型，可解释性强
- **Ridge（L2正则化）**：防止过拟合
- **Lasso（L1正则化）**：自动特征选择，当前最佳模型
- **ElasticNet（L1+L2正则化）**：结合两种正则化优势

### 3. 自动化特征选择

通过Lasso模型实现了自动特征选择，从32个特征中保留了31个重要特征。

### 4. 全面的模型评估

- **性能指标**：R²、RMSE、MAE、MAPE
- **统计检验**：残差正态性检验、异方差检验
- **特征分析**：特征重要性排序、显著性检验

### 5. 可视化分析

生成了4种专业图表，用于：
- 模型效果展示
- 残差诊断
- 特征重要性分析
- 报告和演示

---

## 📈 模型性能总结

### 当前最佳模型：Lasso回归

**性能指标**：
- **R² = 0.3032**：模型解释了约30.32%的方差
- **RMSE = 1.5529**：预测误差（对数尺度）
- **MAPE = 10.46%**：平均预测误差约10.46%

**模型特点**：
- 使用了L1正则化，自动进行了特征选择
- 保留了31/32个特征，剔除了1个冗余特征
- 具有较好的泛化能力

### 数据规模

- **训练样本数**：4,525条
- **特征数量**：32个（包括数值型、二值型、分类变量、时段变量）
- **显著特征**：10个（p < 0.05）

---

## 🔧 技术实现亮点

### 1. 数据预处理
- ✅ 目标变量对数变换（log(x+1)），处理右偏分布
- ✅ 哑变量处理，避免完全共线性
- ✅ 自动识别分类变量和时段变量

### 2. 模型训练
- ✅ 特征标准化（StandardScaler）
- ✅ 5折交叉验证
- ✅ 网格搜索自动调优超参数
- ✅ 训练/测试集划分（80/20）

### 3. 模型评估
- ✅ 多指标评估（R²、RMSE、MAE、MAPE）
- ✅ 残差正态性检验（Shapiro-Wilk）
- ✅ 异方差检验（Breusch-Pagan）
- ✅ 特征显著性分析

### 4. 可视化
- ✅ 预测效果可视化
- ✅ 残差诊断可视化
- ✅ 特征重要性可视化

---

## 📦 交付物清单

### 代码文件（可直接运行）
- ✅ `1_preprocess.py` - 数据预处理
- ✅ `2_check_vif.py` - VIF检查
- ✅ `3_train_model.py` - OLS模型训练
- ✅ `3.5_model_comparison.py` - 多模型对比
- ✅ `4_visualization.py` - 可视化
- ✅ `5_model_evaluation.py` - 评估报告
- ✅ `config.py` - 配置文件

### 模型文件（可用于预测）
- ✅ `output/ols_model_lasso.pkl` - 最佳模型（Lasso）
- ✅ `output/ols_model_lasso_scaler.pkl` - 标准化器

### 结果文件（用于分析和报告）
- ✅ `output/processed_data.csv` - 预处理数据
- ✅ `output/ols_model_comparison.csv` - 模型对比结果
- ✅ `output/evaluation_report.json` - 评估报告
- ✅ `output/plots/*.png` - 4个可视化图表

### 文档文件
- ✅ `README_优化说明.md` - 优化功能说明
- ✅ `使用流程说明.md` - 使用流程文档
- ✅ `回归模型成果总结.md` - 本文件

---

## 💡 给组员的说明

### 如何使用模型进行预测

**方法1：使用保存的模型文件**

```python
import joblib
import pandas as pd
import numpy as np
from sklearn.preprocessing import StandardScaler

# 1. 加载模型和标准化器
model = joblib.load('output/ols_model_lasso.pkl')
scaler = joblib.load('output/ols_model_lasso_scaler.pkl')

# 2. 准备新数据（需要包含所有32个特征）
# 注意：特征顺序和名称必须与训练时一致
new_data = pd.DataFrame({
    'subscriber': [...],
    'channel_avg_views': [...],
    # ... 其他30个特征
})

# 3. 标准化特征
new_data_scaled = scaler.transform(new_data)

# 4. 预测（返回的是log_views）
log_views_pred = model.predict(new_data_scaled)

# 5. 转换回原始尺度（views）
views_pred = np.expm1(log_views_pred)  # exp(log_views) - 1
```

**方法2：重新运行完整流程**

```bash
# 1. 数据预处理
python 1_preprocess.py

# 2. VIF检查（可选）
python 2_check_vif.py

# 3. 训练模型（二选一）
python 3_train_model.py          # 仅OLS模型
python 3.5_model_comparison.py   # 多模型对比（推荐）

# 4. 生成可视化
python 4_visualization.py

# 5. 生成评估报告
python 5_model_evaluation.py
```

### 模型文件说明

- **`ols_model_lasso.pkl`**：这是当前最佳模型，可以直接用于预测
- **`ols_model_lasso_scaler.pkl`**：标准化器，预测时必须使用相同的标准化
- 模型预测的是 **log_views**（对数变换后的观看量），需要转换回原始尺度

### 特征说明

模型使用的32个特征包括：
- **数值型特征（8个）**：订阅者数、频道平均观看量、标题长度等
- **二值特征（5个）**：描述是否含链接、是否含时间戳等
- **分类变量（约19个）**：视频类别（category_*）
- **时段变量（约3个）**：发布时间段（period_*）

详细特征列表请查看 `config.py` 中的 `NUMERIC_COLS` 和 `BINARY_COLS`。

### 注意事项

1. **特征顺序**：预测时特征顺序必须与训练时一致
2. **特征标准化**：必须使用相同的标准化器进行特征标准化
3. **对数变换**：模型预测的是log_views，需要转换回views
4. **缺失值**：如果新数据有缺失值，需要用0填充（与训练时一致）

---

## 📞 联系方式

如有问题，请查看：
- `README_优化说明.md` - 详细功能说明
- `使用流程说明.md` - 完整使用流程

---

**最后更新**：2024年  
**负责人**：回归模型部分
